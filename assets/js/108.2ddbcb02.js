(window.webpackJsonp=window.webpackJsonp||[]).push([[108],{473:function(t,s,e){"use strict";e.r(s);var a=e(42),n=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("当你尝试在WSL上运行32位的程序时，shell将会报错：cannot execute binary file: Exec format error. 这是因为WSL目前暂不支持32位的ELF可执行文件。有人请求在WSL中添加该支持，微软的回复是在做了咕咕咕。但是，没有官方支持和不能用是两回事，StackOverflow上的一个workaround很好地解决了这个问题。原理简而言之，就是利用一个解释器（QEMU）来将32位程序转译成64位程序执行。这个方法在Ubuntu-WSL上的步骤如下：")]),t._v(" "),e("ol",[e("li",[t._v("安装qemu-user-static：")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" qemu-user-static\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[t._v("设置binfmts：")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" update-binfmts --install i386 /usr/bin/qemu-i386-static --magic "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x7f"}},[t._v("\\x7f")]),t._v("ELF"),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x01"}},[t._v("\\x01")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x01"}},[t._v("\\x01")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x01"}},[t._v("\\x01")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x03"}},[t._v("\\x03")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x03"}},[t._v("\\x03")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x03"}},[t._v("\\x03")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x01"}},[t._v("\\x01")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),t._v("'")]),t._v(" --mask "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xfc"}},[t._v("\\xfc")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xf8"}},[t._v("\\xf8")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),t._v("'")]),t._v("\n")])])]),e("ol",{attrs:{start:"3"}},[e("li",[t._v("重启binfmt服务：")])]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("service")]),t._v(" binfmt-support start\n")])])]),e("p",[t._v("启用 i386 架构相关的包：")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" dpkg --add-architecture i386\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v(" update "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("apt")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" gcc:i386\n")])])]),e("p",[t._v("这在Ubuntu-WSL上被证明可以工作得很好。但是，对于Arch-WSL，事情变得略微麻烦了，因为Arch-WSL没有模拟"),e("code",[t._v("systemd")]),t._v("的功能，所以无法像支持systemd的系统一样使用"),e("code",[t._v("systemd")]),t._v("内嵌的"),e("code",[t._v("binfmt")]),t._v("服务，而需要另外安装binfmt-support的包，该包只有AUR提供（以yay作为AUR包管理器为例）： "),e("code",[t._v("yay -S binfmt-support")])]),t._v(" "),e("p",[t._v("另外，qemu在Arch上也只有AUR提供： "),e("code",[t._v("yay -S qemu-user-static")])]),t._v(" "),e("p",[t._v("该包依赖于glib2-static，我在安装时，glib2-static的编译过程因为test不通过而失败，只好在PKGBUILD中手动注释掉test的步骤，然后makepkg -sri进行编译安装。 安装完成后，每次启动系统都要执行")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" update-binfmts --install i386 /usr/bin/qemu-i386-static --magic "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x7f"}},[t._v("\\x7f")]),t._v("ELF"),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x01"}},[t._v("\\x01")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x01"}},[t._v("\\x01")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x01"}},[t._v("\\x01")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x03"}},[t._v("\\x03")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x03"}},[t._v("\\x03")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x03"}},[t._v("\\x03")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x01"}},[t._v("\\x01")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\x00"}},[t._v("\\x00")]),t._v("'")]),t._v(" --mask "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'"),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xfc"}},[t._v("\\xfc")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xf8"}},[t._v("\\xf8")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),e("span",{pre:!0,attrs:{class:"token entity",title:"\\xff"}},[t._v("\\xff")]),t._v("'")]),t._v("\n")])])]),e("p",[t._v("添加支持，这很不方便。可以通过将这一命令添加到/etc/profile中来在每次登录时自动执行这一过程。该命令需要以superuser身份执行，如果你没有设置为sudo所有命令免除密码的话，需要用visudo修改sudoer文件，添加")]),t._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("%USERNAME% "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ALL")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ALL"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" NOPASSWD:/usr/bin/update-binfmts\n")])])]),e("p",[t._v("避免在执行update-binfmts时需要密码。注意将%USERNAME%替换成你的用户名，同时命令必须以绝对路径形式列出，否则sudoer文件不能生效。")])])}),[],!1,null,null,null);s.default=n.exports}}]);